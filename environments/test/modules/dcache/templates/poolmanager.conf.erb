######################################################################
##
## DO NOT EDIT
## generated by puppet module :<%= @name %>
## node :<%= @fqdn %>
##
######################################################################

<%= @poolmanager_conf['cm'].sort.map{|v| "cm #{v}"}.join("\n") %>
<%= @poolmanager_conf['rc'].sort.map{|v| "rc #{v}"}.join("\n") %>
<% @poolmanager_conf['pm'].sort.each do |partiton, p_value| -%>
<% if !p_value['type'].nil? -%>
<% p_value['type']='wass' -%>
<% end -%>
pm create -type=<%= p_value['type'] %> <%= partiton %>
<% if !p_value['options'].nil? -%>
pm set <%= partiton %> <%= p_value['options'].sort.map{|k,v| "-#{k}=#{v}"}.join(' ') %>
<% end -%>
<% end -%>

<%= @poolmanager_conf['psu']['set'].sort.map{|v| "psu set #{v}"}.join("\n") %>
<% ug_create= "" -%>
<% ug_addto= Array.new -%>
<% @poolmanager_conf['psu']['unitgroups'].sort.each do |ug, ug_value| -%>
<% units= Array.new -%>
<% ug_value.sort.each do |ug_name, ugn_value| -%>
<% ug_create += "psu create ugroup #{ug_name}\n" -%>
<% ug_addto << ugn_value.sort.map { |v| "psu addto ugroup #{ug_name} #{v}" } -%>
<% end -%>
<% ug_value.sort.each.map{|k,v| units << v } -%>
#
# The units ...
#
<%= units.flatten.uniq.sort.map{|v| "psu create unit -#{ug} #{v}" }.join("\n") %>
<% end -%>
#
# The unit groups ...
#
<%= ug_create %>
<%= ug_addto.join("\n") %>
<% pool= Array.new -%><%pg_to_create="" -%>
<% @poolmanager_conf['psu']['poolgroups'].sort.each do |poolgroup, pools| -%>
<% pool.push(pools).flatten! -%><% pg_to_create+="psu create pgroup #{poolgroup}\n" -%><% pg_to_create+=pools.sort.map{|v| "psu addto pgroup #{poolgroup} #{v}"}.join("\n") -%><% pg_to_create+="\n\n" -%>
<% end -%>
#
# The pools ...
#
<%= pool.uniq.sort.map { |v| "psu create pool #{v}" }.join("\n") %>
#
# The pool groups ...
#
<%= pg_to_create%>
#
# The links ...
#
<% @poolmanager_conf['psu']['links'].sort.each do |link, link_h| -%>
psu create link <%= link -%> <%= link_h['ug'].join(" ") %>
<% if !link_h['set'].nil? -%>
psu set link <%= link -%> <%= link_h['set'] %>
<% end -%>
psu add link <%= link -%> <%= link_h['pg'].join(" ") %>
<% end -%>
#
# The link Groups ...
#
<%# TODO -%>
